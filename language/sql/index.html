



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../static/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>SQL - Daily Developing Guide (on construction)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../static/css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#index" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Daily Developing Guide (on construction)" aria-label="Daily Developing Guide (on construction)" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Daily Developing Guide (on construction)
            </span>
            <span class="md-header-nav__topic">
              
                SQL
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Daily Developing Guide (on construction)" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    Daily Developing Guide (on construction)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Language
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Language
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        SQL
      </label>
    
    <a href="./" title="SQL" class="md-nav__link md-nav__link--active">
      SQL
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    Index
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-join" class="md-nav__link">
    Table Join
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#join-tips" class="md-nav__link">
    Join Tips
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-definition-statements" class="md-nav__link">
    Data Definition Statements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debug" class="md-nav__link">
    Debug
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffrence-between-union-and-union-all" class="md-nav__link">
    Diffrence between union and union all
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-table" class="md-nav__link">
    Cache Table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-query-sample" class="md-nav__link">
    SQL Query Sample
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cumulative-distinct-count" class="md-nav__link">
    cumulative distinct count
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referral" class="md-nav__link">
    Referral
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unix_commnads_bash/" title="Unix Commands & Bash" class="md-nav__link">
      Unix Commands & Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../css/" title="CSS" class="md-nav__link">
      CSS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Library
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Library
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../library/pytest/" title="Pytest" class="md-nav__link">
      Pytest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../library/numpy/" title="Numpy" class="md-nav__link">
      Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../library/pandas/" title="Pandas" class="md-nav__link">
      Pandas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../library/sklearn/" title="Sklearn" class="md-nav__link">
      Sklearn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../library/altair/" title="Altair" class="md-nav__link">
      Altair
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/nginx/" title="Nginx" class="md-nav__link">
      Nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/supervisor/" title="Supervisor" class="md-nav__link">
      Supervisor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/mkdocs/" title="Mkdocs" class="md-nav__link">
      Mkdocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/jekyll/" title="Jekyll" class="md-nav__link">
      Jekyll
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/django/" title="Django" class="md-nav__link">
      Django
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/flask/" title="Flask" class="md-nav__link">
      Flask
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/airflow/" title="Airflow" class="md-nav__link">
      Airflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/scrapy/" title="Scrapy" class="md-nav__link">
      Scrapy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/mongo/" title="Mongo" class="md-nav__link">
      Mongo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/streamlit/" title="Streamlit" class="md-nav__link">
      Streamlit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/restfulapi/" title="RestfulAPI" class="md-nav__link">
      RestfulAPI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/dataProcessing/" title="Data processing" class="md-nav__link">
      Data processing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/chart/" title="Chart" class="md-nav__link">
      Chart
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    Index
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-join" class="md-nav__link">
    Table Join
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#join-tips" class="md-nav__link">
    Join Tips
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-definition-statements" class="md-nav__link">
    Data Definition Statements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debug" class="md-nav__link">
    Debug
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffrence-between-union-and-union-all" class="md-nav__link">
    Diffrence between union and union all
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-table" class="md-nav__link">
    Cache Table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-query-sample" class="md-nav__link">
    SQL Query Sample
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cumulative-distinct-count" class="md-nav__link">
    cumulative distinct count
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referral" class="md-nav__link">
    Referral
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>SQL</h1>
                
                <h2 id="index">Index<a class="headerlink" href="#index" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#index">Index</a></li>
<li><a href="#table-join">Table Join</a></li>
<li><a href="#join-tips">Join Tips</a></li>
<li><a href="#data-definition-statements">Data Definition Statements</a></li>
<li><a href="#debug">Debug</a></li>
<li><a href="#diffrence-between-union-and-union-all">Diffrence between union and union all</a></li>
<li><a href="#cache-table">Cache Table</a></li>
<li><a href="#sql-query-sample">SQL Query Sample</a><ul>
<li><a href="#cumulative-distinct-count">cumulative distinct count</a></li>
</ul>
</li>
<li><a href="#referral">Referral</a></li>
</ul>
<h2 id="table-join">Table Join<a class="headerlink" href="#table-join" title="Permanent link">&para;</a></h2>
<p>There are two ways to implement join: inner join, outer join。The main diffrence is whether to keep not matched reocrds。</p>
<ul>
<li><code>JOIN</code> == <code>INNER JOIN</code></li>
<li><code>LEFT JOIN</code> == <code>LEFT OUTER JOIN</code></li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="n">select_list</span> <span class="k">FROM</span>
  <span class="n">table_or_subquery1</span> <span class="p">[</span><span class="k">INNER</span><span class="p">]</span> <span class="k">JOIN</span> <span class="n">table_or_subquery2</span> <span class="o">|</span>
  <span class="n">table_or_subquery1</span> <span class="err">{</span><span class="k">LEFT</span> <span class="p">[</span><span class="k">OUTER</span><span class="p">]</span> <span class="o">|</span> <span class="k">RIGHT</span> <span class="p">[</span><span class="k">OUTER</span><span class="p">]</span> <span class="o">|</span> <span class="k">FULL</span> <span class="p">[</span><span class="k">OUTER</span><span class="p">]</span><span class="err">}</span> <span class="k">JOIN</span> <span class="n">table_or_subquery2</span> <span class="o">|</span>
  <span class="n">table_or_subquery1</span> <span class="err">{</span><span class="k">LEFT</span> <span class="o">|</span> <span class="k">RIGHT</span><span class="err">}</span> <span class="n">SEMI</span> <span class="k">JOIN</span> <span class="n">table_or_subquery2</span> <span class="o">|</span>
  <span class="n">table_or_subquery1</span> <span class="err">{</span><span class="k">LEFT</span> <span class="o">|</span> <span class="k">RIGHT</span><span class="err">}</span> <span class="n">ANTI</span> <span class="k">JOIN</span> <span class="n">table_or_subquery2</span> <span class="o">|</span>
    <span class="p">[</span> <span class="k">ON</span> <span class="n">col1</span> <span class="o">=</span> <span class="n">col2</span> <span class="p">[</span><span class="k">AND</span> <span class="n">col3</span> <span class="o">=</span> <span class="n">col4</span> <span class="p">...]</span> <span class="o">|</span>
      <span class="k">USING</span> <span class="p">(</span><span class="n">col1</span> <span class="p">[,</span> <span class="n">col2</span> <span class="p">...])</span> <span class="p">]</span>
  <span class="p">[</span><span class="n">other_join_clause</span> <span class="p">...]</span>
<span class="p">[</span> <span class="k">WHERE</span> <span class="n">where_clauses</span> <span class="p">]</span>
</code></pre></div>


<h3 id="join-tips">Join Tips<a class="headerlink" href="#join-tips" title="Permanent link">&para;</a></h3>
<ul>
<li>The join key is not suggest to write in <code>where</code> to avoid confusion and improve readability.</li>
<li>One kind of association is to associate itself, which implement a tree structure in a parent-child relationship, and implement cumulative calculations.</li>
<li>Equijoins and Non-Equijoins: The latter allows the use of <code>&gt;</code> and <code>&lt;</code>.</li>
<li>There is a query called Semi-joins, which can only return the rows that match on the left. No matter how many rows on the right match, the left will only match up to one row. Anti-joins, in turn, only returns rows that have not been matched.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="n">t1</span><span class="p">.</span><span class="n">c1</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">c2</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">c2</span> <span class="k">FROM</span> <span class="n">t1</span> <span class="k">LEFT</span> <span class="n">SEMI</span> <span class="k">JOIN</span> <span class="n">t2</span> <span class="k">ON</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></div>


<ul>
<li>CROSS JOIN is a row-to-row pairwise match between tables.</li>
</ul>
<h2 id="data-definition-statements">Data Definition Statements<a class="headerlink" href="#data-definition-statements" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Create table</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tablex</span><span class="p">(</span><span class="n">field1</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">field2</span> <span class="nb">char</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

<span class="c1">-- Create index</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">index_name</span> <span class="k">ON</span> <span class="n">tablex</span> <span class="p">(</span><span class="n">field1</span><span class="p">);</span>

<span class="c1">-- Drop index</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tablex</span> <span class="k">DROP</span> <span class="k">INDEX</span> <span class="n">index_name</span>

<span class="c1">-- Rename filed</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tablex</span> <span class="n">tablex</span> <span class="k">RENAME</span> <span class="n">tabley</span><span class="p">;</span>

<span class="c1">-- Insert recordss</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tablex</span> <span class="k">VALUES</span><span class="p">(</span><span class="ss">&quot;xx&quot;</span><span class="p">,</span><span class="ss">&quot;1&quot;</span><span class="p">);</span>

<span class="c1">-- Update recordss</span>
<span class="k">UPDATE</span> <span class="k">TABLE</span> <span class="n">tablex</span> <span class="k">SET</span> <span class="n">field1</span> <span class="o">=</span> <span class="ss">&quot;&quot;</span> <span class="k">WHERE</span> <span class="n">field2</span> <span class="o">=</span> <span class="ss">&quot;m&quot;</span> <span class="p">;</span>

<span class="c1">-- Delete recordss</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">tablex</span> <span class="k">WHERE</span> <span class="n">field2</span> <span class="o">=</span> <span class="ss">&quot;m&quot;</span><span class="p">;</span>

<span class="c1">-- Delete table</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">tablex</span><span class="p">;</span>
</code></pre></div>


<h2 id="debug">Debug<a class="headerlink" href="#debug" title="Permanent link">&para;</a></h2>
<h3 id="diffrence-between-union-and-union-all">Diffrence between union and union all<a class="headerlink" href="#diffrence-between-union-and-union-all" title="Permanent link">&para;</a></h3>
<p>The <code>union</code> will delete duplicate rows but <code>union all</code> not.</p>
<h2 id="cache-table">Cache Table<a class="headerlink" href="#cache-table" title="Permanent link">&para;</a></h2>
<p>Cache tables and summary tables can improve the efficiency of repeated queries. The cache table is divided into continuously adding data or rebuilding the table periodically. When rebuildng table, in order to ensure that the table is available during the rebuild, a strategy called shadow table can be used. This design also maintains a historical data table for easy backtracking. From "High Performance MySQL".</p>
<div class="codehilite"><pre><span></span><code><span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">my_summary_new</span><span class="p">,</span> <span class="n">my_summary_old</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mys_summary_new</span> <span class="k">LIKE</span> <span class="n">my_summary</span><span class="p">;</span>
<span class="c1">-- populate my_summary_new as desird</span>
<span class="k">RENAME</span> <span class="k">TABLE</span> <span class="n">my_summmary</span> <span class="k">TO</span> <span class="n">my_summary_old</span><span class="p">,</span> <span class="n">my_summary_new</span> <span class="k">TO</span> <span class="n">my_summary</span><span class="p">;</span>
</code></pre></div>


<h2 id="sql-query-sample">SQL Query Sample<a class="headerlink" href="#sql-query-sample" title="Permanent link">&para;</a></h2>
<h4 id="cumulative-distinct-count">cumulative distinct count<a class="headerlink" href="#cumulative-distinct-count" title="Permanent link">&para;</a></h4>
<p>Q: Suppose there is a Rawdata data table, there is a user field that needs to be deduplicated, and you need to calculate the cumulative number of users from January, January to February, January to March ... How to achieve it?</p>
<p>A：Use Non-Equijoins like below.</p>
<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="n">cte1</span> <span class="k">as</span><span class="p">(</span>
<span class="k">select</span> <span class="k">distinct</span> <span class="k">month</span>
<span class="k">from</span> <span class="n">monthuser</span>
<span class="p">),</span>
<span class="n">cte2</span> <span class="k">as</span><span class="p">(</span>
<span class="k">select</span> <span class="n">t1</span><span class="p">.</span><span class="k">month</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="k">month</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">userid</span>
<span class="k">from</span> <span class="n">cte1</span> <span class="k">as</span> <span class="n">t1</span>
<span class="k">left</span> <span class="k">join</span> <span class="n">monthuser</span> <span class="k">as</span> <span class="n">t2</span>
<span class="k">on</span> <span class="n">t1</span><span class="p">.</span><span class="k">month</span> <span class="o">&gt;=</span> <span class="n">t2</span><span class="p">.</span><span class="k">month</span><span class="p">)</span>
<span class="k">select</span> <span class="k">month</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">userid</span><span class="p">)</span> <span class="k">as</span> <span class="n">users</span>
<span class="k">from</span> <span class="n">cte2</span>
<span class="k">group</span> <span class="k">by</span> <span class="mi">1</span>
<span class="k">order</span> <span class="k">by</span> <span class="mi">1</span>
</code></pre></div>


<h2 id="referral">Referral<a class="headerlink" href="#referral" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.cloudera.com/documentation/enterprise/5-5-x/topics/impala_langref_sql.html">Impala SQL</a></li>
<li><a href="https://spark.apache.org/docs/2.3.0/api/sql/">Spark SQL</a></li>
<li><a href="https://spark.apache.org/docs/latest/api/python/pyspark.sql.html">Pyspark.sql</a></li>
<li><a href="https://www.postgresql.org/docs/current/index.html">PostgreSQL</a></li>
<li><a href="https://docs.microsoft.com/en-us/sql/sql-server/sql-server-technical-documentation?view=sql-server-2017">SQLServer2017</a></li>
<li><a href="https://www.sqlite.org/lang_corefunc.html">SQlite SQL core functions</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/">MySQL</a></li>
<li>[Impala SQL join][https://docs.cloudera.com/documentation/enterprise/5-5-x/topics/impala_joins.html]</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../python/" title="Python" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Python
              </span>
            </div>
          </a>
        
        
          <a href="../unix_commnads_bash/" title="Unix Commands & Bash" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Unix Commands & Bash
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>